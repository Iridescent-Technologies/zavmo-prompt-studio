name: Zavmo Prompt Studio — Smoke Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  smoke-test:
    name: Run Smoke Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run smoke tests
        run: node tests/smoke-test.js

      - name: Check file size
        run: |
          SIZE=$(stat --printf="%s" index.html)
          SIZE_KB=$((SIZE / 1024))
          echo "index.html is ${SIZE_KB}KB"
          if [ "$SIZE_KB" -gt 1024 ]; then
            echo "::warning::index.html is ${SIZE_KB}KB — consider splitting into modules"
          fi

      - name: Check for common issues
        run: |
          echo "Checking for console.log statements..."
          COUNT=$(grep -c "console\.log" index.html || true)
          if [ "$COUNT" -gt 20 ]; then
            echo "::warning::Found $COUNT console.log statements — consider removing debug logs"
          fi

          echo "Checking for TODO/FIXME comments..."
          TODOS=$(grep -ci "TODO\|FIXME\|HACK\|XXX" index.html || true)
          if [ "$TODOS" -gt 0 ]; then
            echo "::notice::Found $TODOS TODO/FIXME comments"
            grep -n "TODO\|FIXME\|HACK\|XXX" index.html || true
          fi
